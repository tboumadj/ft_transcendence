import{f as q,ao as A,aq as S,h as $,i as x,k as M,t as B,ax as O,_ as j,o as f,$ as w,d as s,a0 as p,a5 as D,l as c,r as T,a,w as l,aX as u,a1 as V,a8 as E,aC as v,c as N,x as H,a7 as F,a4 as h,aW as k,a_ as Q,e as y,M as g,aZ as z,aa as C,a9 as I,aY as U,b1 as W,a6 as R}from"./index.dfe8dbd2.js";import{Q as J}from"./QImg.202e5004.js";import{C as P}from"./ClosePopup.5691a751.js";const K=["horizontal","vertical","cell","none"];var L=q({name:"QMarkupTable",props:{...A,dense:Boolean,flat:Boolean,bordered:Boolean,square:Boolean,wrapCells:Boolean,separator:{type:String,default:"horizontal",validator:t=>K.includes(t)}},setup(t,{slots:e}){const r=B(),o=S(t,r.proxy.$q),n=$(()=>`q-markup-table q-table__container q-table__card q-table--${t.separator}-separator`+(o.value===!0?" q-table--dark q-table__card--dark q-dark":"")+(t.dense===!0?" q-table--dense":"")+(t.flat===!0?" q-table--flat":"")+(t.bordered===!0?" q-table--bordered":"")+(t.square===!0?" q-table--square":"")+(t.wrapCells===!1?" q-table--no-wrap":""));return()=>x("div",{class:n.value},[x("table",{class:"q-table"},M(e.default))])}});const G=O({props:{data:{type:Object,required:!0}}}),Y={key:0},X={class:"text-left"},Z={class:"text-left"},ee={class:"text-left"};function te(t,e,r,o,n,d){return t.data?(f(),w("tbody",Y,[s("tr",null,[s("td",X,p(t.data.opponent.name),1),s("td",Z,p(t.data.scorP1)+" - "+p(t.data.scorP2),1),s("td",ee,p(t.data.win?"Win":"Loss"),1)])])):D("",!0)}var oe=j(G,[["render",te]]);const ae={components:{ModulHistory:oe},props:{user:{type:Object,required:!0}},setup(){return{data:c([]),localIp:window.location.hostname}},methods:{async fetchHistory(){try{const e=await(await fetch(`http://${this.localIp}:3000/api/game?userId=${this.user.id}`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"})).json();let r=[];e.forEach(o=>{let n=!1,d={name:""};this.user.id===o.p1Id?(n=o.scorP1>o.scorP2,d={name:o.p2.name}):this.user.id===o.p2Id&&(n=o.scorP2>o.scorP1,d={name:o.p1.name}),r.push({scorP1:o.scorP1,scorP2:o.scorP2,playedOn:o.playedOn,opponent:d,win:n})}),this.data=r}catch{console.error("error with friendlist")}}},mounted(){this.fetchHistory()}},se={class:"q-pa-md"},re=s("div",{class:"text-h6"},"Match History",-1),le={class:"text-subtitle2"},ne=s("thead",null,[s("tr",null,[s("th",{class:"text-left"},"Against"),s("th",{class:"text-left"},"Score"),s("th",{class:"text-left"},"W/L")])],-1),ie={key:1},de=s("td",{colspan:"3"},"No match history available",-1),ce=[de];function ue(t,e,r,o,n,d){const b=T("ModulHistory");return f(),w("div",se,[a(v,{class:"history",flat:"",bordered:""},{default:l(()=>[a(u,null,{default:l(()=>[re,s("div",le,p(r.user.pseudo),1)]),_:1}),a(L,null,{default:l(()=>[ne,o.data.length?(f(!0),w(V,{key:0},E(o.data,(_,m)=>(f(),N(b,{key:m,data:_},null,8,["data"]))),128)):(f(),w("tr",ie,ce))]),_:1})]),_:1})])}var pe=j(ae,[["render",ue]]);const he={setup(){return{card:c(!1),prompt:c(!1),prompt2:c(!1),promptav:c(!1),value:c(!1),pseudo:c(""),oldpassword:c(""),newpassword:c(""),imageUrl:c(""),bus:H("bus")}},components:{Notification:F,MyHistory:pe},data(){return{profileData:{},dataHist:{},baseUrl:"http://"+window.location.hostname+":3000/",localIp:window.location.hostname}},methods:{submitForm(){var r;const e=(r=this.$refs.fileInput.files)==null?void 0:r[0];e?this.uploadImage(e):this.imageUrl?this.uploadImageUrl(this.imageUrl):console.error("Pls Select a file or specify Url")},async uploadImage(t){const e=new FormData;e.append("image",t);const r=localStorage.getItem("jwtToken");try{const o=await fetch(`http://${this.localIp}:3000/api/update/UploadAvatar`,{method:"POST",headers:{Authorization:`Bearer ${r}`},credentials:"include",body:e});this.fetchProfileData(),this.bus.emit("refreshProfile")}catch(o){console.error("Error with Avatard upload : ",o)}},async uploadImageUrl(t){try{const e=localStorage.getItem("jwtToken"),r=await fetch(`http://${this.localIp}:3000/api/update/UploadAvatarUrl`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},credentials:"include",body:JSON.stringify({imageUrl:t})});this.fetchProfileData(),this.bus.emit("refreshProfile")}catch(e){console.error("error With AvatardUrl upload : ",e)}},async updateP(){try{const t=localStorage.getItem("jwtToken");if(this.pseudo===""){const o=" : ERROR";this.$refs.notification.showNotification("No one in Parameter for Pseudo"+o);return}(await(await fetch(`http://${this.localIp}:3000/api/update/Name`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},credentials:"include",body:JSON.stringify({pseudo:this.pseudo})})).json()).pseudo?(this.fetchProfileData(),this.bus.emit("refreshProfile")):console.log("Error with change Pseudo")}catch(t){console.error("Erreur lors du changement de pseudo",t)}},async updateM(){try{const t=localStorage.getItem("jwtToken");if(this.newpassword===""){const o=" : ERROR";this.$refs.notification.showNotification("No one in Parameter for NewPassword"+o);return}(await(await fetch(`http://${this.localIp}:3000/api/update/Pass`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},credentials:"include",body:JSON.stringify({testpass:this.oldpassword,password:this.newpassword})})).json()).password?(console.log("Password has been updated"),this.fetchProfileData()):console.log("Error with change Password")}catch(t){console.error("Erreur lors du changement de password",t)}},async checkToken(){const t=localStorage.getItem("jwtToken");if(t)try{(await(await fetch(`http://${this.localIp}:3000/api/auth/checkJWT`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},credentials:"include"})).json()).success?console.log("user validate!"):(console.log("Unvalidate user!"),this.logOutUser())}catch{console.log("Error with validating JWT!"),this.logOutUser()}else console.log("User not connected!"),this.$router.push("/")},async logOutUser(){try{const t=localStorage.getItem("jwtToken");if(t){const r=await(await fetch(`http://${this.localIp}:3000/api/update/disable2fa`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},credentials:"include"})).json();this.bus.emit("inOffSet"),localStorage.removeItem("jwtToken"),console.log("User disconnect : Jwt deleted!"),this.$router.push("/")}}catch{console.log("error with disconnect User")}},async check2FA(){let t=!1;const e=this.value;if(this.profileData.twoFactorAuth===!0&&(t=await this.checkValid2fa(this.profileData.id),t===!1)){this.value=!0;return}const r=localStorage.getItem("jwtToken");if(r){const n=await(await fetch(`http://${this.localIp}:3000/api/update/checkTwoF`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},credentials:"include",body:JSON.stringify({value:e})})).json();this.fetchProfileData(),n.value2f===!0&&n.valid2f===!1&&this.goTo2fa(n.userId)}},async checkValid2fa(t){const e=window.prompt("Veuillez entrer le code \xE0 v\xE9rifier","");return e!==null?await this.verify2faCode(t,e):(console.log("L'utilisateur a annul\xE9 la saisie du code"),!1)},async verify2faCode(t,e){try{return(await(await fetch(`http://${this.localIp}:3000/api/auth/verify2fa?userId=${t}&code=${e}`)).json()).success?(console.log("Le code 2FA est valide."),!0):(console.log("Le code 2FA est invalide."),!1)}catch(r){return console.error("Erreur lors de la v\xE9rification du code 2FA :",r),!1}},async goTo2fa(t){const o=(window.screen.width-600)/2,n=(window.screen.height-600)/2;try{const _=(await(await fetch(`http://${this.localIp}:3000/api/auth/2FAdir?userId=${t}`)).json()).uri,m=window.open(`https://api.qrserver.com/v1/create-qr-code/?data=${encodeURIComponent(_)}&size=150x150`,"QR Window",`width=${600}, height=${600}, left=${o}, top=${n}`);m&&(m.onload=()=>{console.log("Generate QrCode")})}catch{console.error("cannot go to 2fa")}},async fetchProfileData(){try{const t=localStorage.getItem("jwtToken");if(t){const r=await(await fetch(`http://${this.localIp}:3000/api/auth/profile`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},credentials:"include"})).json();this.profileData=r,this.dataHist={id:this.profileData.id,pseudo:this.profileData.pseudo},this.value=this.profileData.twoFactorAuth}}catch{console.log("error")}}},mounted(){this.checkToken(),this.fetchProfileData(),this.bus.emit("inOnSet")}},fe={class:"page-container"},me={class:"flex-container"},we=s("label",{for:"file"},"Download Avatar : ",-1),_e={type:"file",id:"file",ref:"fileInput",accept:"image/*"},ye=s("br",null,null,-1),ge=s("label",{for:"imageUrl"},"Url of Avatar : ",-1),ve=s("br",null,null,-1),be=s("button",{type:"submit"},"Submit",-1),ke=s("br",null,null,-1),Pe={class:"row no-wrap items-center"},Te={class:"col text-h6 ellipsis"},Ce=s("div",{class:"text-h6"},"Your new Pseudo",-1),Ie={class:"text-caption text-grey"},Ue={class:"text-subtitle1"},je={class:"q-pa-md"},xe=s("div",{class:"text-h6"},"Old Password",-1),De=s("div",{class:"text-h6"},"New Password",-1),Ve={class:"button-container"},qe=s("br",null,null,-1),Ae=s("br",null,null,-1),Se={key:0};function $e(t,e,r,o,n,d){const b=T("Button"),_=T("MyHistory"),m=T("Notification");return f(),w(V,null,[s("div",fe,[s("h2",null,"Welcome [ "+p(n.profileData.pseudo)+" ]",1)]),s("div",me,[a(h,{label:"My info",color:"primary",onClick:e[0]||(e[0]=i=>o.card=!0)}),a(k,{modelValue:o.card,"onUpdate:modelValue":e[13]||(e[13]=i=>o.card=i)},{default:l(()=>[a(v,{class:"my-card"},{default:l(()=>[a(J,{src:`${n.baseUrl}api/uploadAvatar/${n.profileData.avatar}`,crossorigin:t.credentials?"use-credentials":"anonymous"},null,8,["src","crossorigin"]),a(u,null,{default:l(()=>[a(h,{fab:"",color:"primary",icon:"build",class:"absolute",style:{top:"0",right:"10px",transform:"translateY(-90%)"},onClick:e[1]||(e[1]=i=>o.promptav=!0)}),a(k,{modelValue:o.promptav,"onUpdate:modelValue":e[4]||(e[4]=i=>o.promptav=i)},{default:l(()=>[a(v,{style:{"min-width":"350px"}},{default:l(()=>[a(u,null,{default:l(()=>[s("form",{onSubmit:e[3]||(e[3]=Q((...i)=>d.submitForm&&d.submitForm(...i),["prevent"]))},[we,s("input",_e,null,512),y(" -------------------------------------------"),ye,ge,g(s("input",{type:"text",id:"imageUrl","onUpdate:modelValue":e[2]||(e[2]=i=>o.imageUrl=i)},null,512),[[z,o.imageUrl]]),ve,be],32)]),_:1})]),_:1})]),_:1},8,["modelValue"]),y(" ---------------------------------------------------"),ke,s("div",Pe,[s("div",Te,[y(p(n.profileData.pseudo)+" ",1),a(h,{color:"primary",icon:"build",onClick:e[5]||(e[5]=i=>o.prompt=!0)}),a(k,{modelValue:o.prompt,"onUpdate:modelValue":e[7]||(e[7]=i=>o.prompt=i)},{default:l(()=>[a(v,{style:{"min-width":"350px"}},{default:l(()=>[a(u,null,{default:l(()=>[Ce]),_:1}),a(u,{class:"q-pt-none"},{default:l(()=>[a(C,{dense:"",modelValue:o.pseudo,"onUpdate:modelValue":e[6]||(e[6]=i=>o.pseudo=i),autofocus:"",onKeyup:I(d.updateP,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),a(U,{align:"right",class:"text-primary"},{default:l(()=>[g(a(h,{flat:"",label:"Cancel"},null,512),[[P]]),g(a(h,{flat:"",onClick:d.updateP,label:"Confirm"},null,8,["onClick"]),[[P]])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),s("div",Ie," Username: ( "+p(n.profileData.username)+" ) ",1)]),_:1}),a(u,{class:"q-pt-none"},{default:l(()=>[s("div",Ue,p(n.profileData.email),1)]),_:1}),s("div",je,[a(W,{modelValue:o.value,"onUpdate:modelValue":e[8]||(e[8]=i=>o.value=i),color:"primary","keep-color":"",onClick:d.check2FA},null,8,["modelValue","onClick"]),y(" Activ 2FA ")]),a(R),a(U,{align:"right"},{default:l(()=>[a(h,{label:"Change Password",color:"primary",onClick:e[9]||(e[9]=i=>o.prompt2=!0)})]),_:1})]),_:1}),a(k,{modelValue:o.prompt2,"onUpdate:modelValue":e[12]||(e[12]=i=>o.prompt2=i)},{default:l(()=>[a(v,{style:{"min-width":"350px"}},{default:l(()=>[a(u,null,{default:l(()=>[xe]),_:1}),a(u,{class:"q-pt-none"},{default:l(()=>[a(C,{dense:"",modelValue:o.oldpassword,"onUpdate:modelValue":e[10]||(e[10]=i=>o.oldpassword=i),autofocus:"",onKeyup:I(d.updateM,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),a(u,null,{default:l(()=>[De]),_:1}),a(u,{class:"q-pt-none"},{default:l(()=>[a(C,{dense:"",modelValue:o.newpassword,"onUpdate:modelValue":e[11]||(e[11]=i=>o.newpassword=i),autofocus:"",onKeyup:I(d.updateM,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),a(U,{align:"right",class:"text-primary"},{default:l(()=>[g(a(h,{flat:"",label:"Cancel"},null,512),[[P]]),g(a(h,{flat:"",onClick:d.updateM,label:"Confirm"},null,8,["onClick"]),[[P]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),s("div",Ve,[qe,Ae,a(b,{onClick:d.logOutUser,class:"custom-button"},{default:l(()=>[y("Log Out")]),_:1},8,["onClick"])])]),n.dataHist.id&&n.dataHist.pseudo?(f(),w("div",Se,[a(_,{user:n.dataHist},null,8,["user"])])):D("",!0),a(m,{ref:"notification"},null,512)],64)}var Ee=j(he,[["render",$e]]);export{Ee as default};
