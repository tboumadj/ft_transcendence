import{b,Q as U,a as M,c as B,d as P}from"./QLayout.bee7a0fb.js";import{Q as z,a as q,b as x}from"./QTabs.b3be5209.js";import{_ as F,l,x as E,o as h,$ as y,a as s,w as r,M as C,c as p,e as $,a0 as k,R as L,a2 as N,a3 as Q,d as a,a4 as f,a5 as S,a6 as G,a1 as T,a7 as V,n as W,r as w,a8 as H,Q as A,a9 as J,aa as K}from"./index.dfe8dbd2.js";import{Q as D}from"./QImg.202e5004.js";import{Q as O,a as I,b as R,c as Y}from"./QList.a69f75ff.js";import{l as X}from"./index.9bf75406.js";const Z={props:{search_data:{type:Object,default:null}},setup(){return{dm:l(!1),friend:l(!1),bus:E("bus"),state:l({})}},data(){return{baseUrl:"http://"+window.location.hostname+":3000/",localIp:window.location.hostname,showContent:!1,Avatar:null,id:l(0),color:l({})}},computed:{searchUsername(){return this.search_data?this.search_data.username:""}},mounted(){this.searchAvatar(),this.areWeFriend(),this.fetchState(),this.bus.on("refreshFriend",()=>{this.fetchState()})},methods:{toggleCard(){this.showContent=!this.showContent},redirectToFriend(){this.search_data?this.$router.push({path:`/friend/${this.id}`}):this.$router.push({path:`/friend/${this.id}`})},searchAvatar(){return this.search_data?(this.id=this.search_data.id,this.Avatar=this.search_data.avatar,this.search_data.avatar):""},async addFriend(){try{const e=localStorage.getItem("jwtToken");e&&((await(await fetch(`http://${this.localIp}:3000/api/update/addFriend`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},credentials:"include",body:JSON.stringify({friend:this.id})})).json()).success==!0?(console.log("FRIEND FOR LIFE"),this.areWeFriend(),this.bus.emit("freshFriend")):console.log("WE ALREADY FRIEND"))}catch(e){console.error("BUG WITH ADDING FRIEND",e)}},async areWeFriend(){try{const e=localStorage.getItem("jwtToken");e&&((await(await fetch(`http://${this.localIp}:3000/api/auth/profile`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},credentials:"include"})).json()).friends.includes(+this.id)===!0?this.friend=!0:this.friend=!1)}catch{console.log("error")}},async fetchState(){try{const t=await(await fetch(`http://${this.localIp}:3000/api/status`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"})).json();console.log("resultStatus = ",t),this.id in t?(console.log("TEST",t[this.id].state),this.state=t[this.id].state,this.colorMyFriend()):this.color="state-0"}catch{console.error("Error with fetch StateFriend")}},colorMyFriend(){this.state===0?this.color="state-0":this.state===1?this.color="state-1":this.state===2?this.color="state-2":this.state===3&&(this.color="state-3")}}},ee={class:"flex-container"},te={class:"row no-wrap items-center"},se={class:"col text-h6 ellipsis"};function oe(e,t,c,o,n,i){return h(),y(T,null,[s(R,{bordered:"",class:N(`${n.color}`)},{default:r(()=>[C((h(),p(O,{clickable:"",onClick:i.toggleCard},{default:r(()=>[s(I,{avatar:""},{default:r(()=>[s(b,{square:""},{default:r(()=>[s(D,{src:`${n.baseUrl}api/uploadAvatar/${n.Avatar}`,crossorigin:e.credentials?"use-credentials":"anonymous"},null,8,["src","crossorigin"])]),_:1})]),_:1}),s(I,{style:{color:"white"}},{default:r(()=>[$("[ "+k(i.searchUsername)+" ]",1)]),_:1})]),_:1},8,["onClick"])),[[L]])]),_:1},8,["class"]),C(a("div",ee,[a("div",te,[a("div",se,[s(f,{color:"primary",icon:"account_circle",onClick:i.redirectToFriend},null,8,["onClick"]),o.friend===!1?(h(),p(f,{key:0,color:"positive",icon:"favorite",onClick:i.addFriend},null,8,["onClick"])):S("",!0)])]),s(G)],512),[[Q,n.showContent]])],64)}var re=F(Z,[["render",oe]]);const ae={props:{user:{type:Object,required:!0}},setup(){return{suppr:l(!1),bus:E("bus"),state:l({}),color:l({}),dialog:l(!1),private:l(!1)}},data(){return{baseUrl:"http://"+window.location.hostname+":3000/",localIp:window.location.hostname,showContent:!1,id:{}}},methods:{toggleCard(){this.showContent=!this.showContent},redirectToFriend(){this.$router.push({path:`/friend/${this.user.id}`})},async sendMessage(){try{console.log("Sending invit message");const e=this.user.id,t="yes";this.$router.push({path:"chat",query:{frind_id:e,owner:t}})}catch(e){console.error("Cannot Send private Message",e)}},async receiveMessage(){try{console.log("Accept invit message");const e=this.user.id,t="no";this.private=!1,this.$router.push({path:"chat",query:{frind_id:e,owner:t}})}catch(e){console.error("Cannot Send private Message",e)}},async sendMatch(){try{console.log("Sending invitation");const e="yes",t=this.user.id,c="no";this.$router.push({path:"game",query:{owner:e,frind_id:t,accept:c}})}catch(e){console.error("Cannot send Invitation to match with this friend",e)}},async deleteFriend(){try{const e=localStorage.getItem("jwtToken");e&&((await(await fetch(`http://${this.localIp}:3000/api/update/deleteFriend`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},credentials:"include",body:JSON.stringify({friend:this.user.id})})).json()).success==!0?(console.log("FRIEND DELETED"),this.bus.emit("freshFriend")):console.log("FRIEND Not DELETE"))}catch(e){console.error("BUG WITH DELETING FRIEND",e)}},async fetchState(){try{const t=await(await fetch(`http://${this.localIp}:3000/api/status`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"})).json();this.user.id in t?(this.state=t[this.user.id].state,this.colorMyFriend(),t[this.user.id].state===2&&await this.fetchInvit(),t[this.user.id].state===3&&await this.fetchMessage()):this.color="state-0"}catch{console.error("Error with fetch StateFriend")}},async fetchInvit(){try{const e=localStorage.getItem("jwtToken");e&&await(await fetch(`http://${this.localIp}:3000/api/auth/profile/invit`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},credentials:"include"})).json()===!0&&this.$q.dialog({title:"Invitation To A Match",message:"A Friend Invite You To PongGame",cancel:!0,persistent:!0}).onOk(()=>{fetch(`http://${this.localIp}:3000/api/update/ResInv`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},credentials:"include"});const o="no",n=this.user.id,i="yes";this.$router.push({path:"game",query:{owner:o,frind_id:n,accept:i}}),console.log("L'utilisateur a choisi Oui")}).onCancel(()=>{fetch(`http://${this.localIp}:3000/api/update/ResInv`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},credentials:"include"}),console.log("L'utilisateur a choisi Non")})}catch(e){console.error("Error cannot look my invitation",e)}},async fetchMessage(){try{const e=localStorage.getItem("jwtToken");e&&(await(await fetch(`http://${this.localIp}:3000/api/auth/profile/message`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},credentials:"include"})).json()===!0?this.private=!0:console.log("No invit Message"))}catch(e){console.error("Error cannot look my invitation",e)}},colorMyFriend(){this.state===0?this.color="state-0":this.state===1?this.color="state-1":this.state===2?this.color="state-2":this.state===3&&(this.color="state-3")}},mounted(){this.fetchState(),this.bus.on("refreshList",()=>{this.fetchState()})}},ne={class:"flex-container"},ie={class:"row no-wrap items-center"},ce={class:"col text-h6 ellipsis"};function le(e,t,c,o,n,i){return h(),y(T,null,[s(R,{bordered:"",class:N(`${o.color}`)},{default:r(()=>[C((h(),p(O,{clickable:"",onClick:i.toggleCard},{default:r(()=>[s(I,{avatar:""},{default:r(()=>[s(b,{square:""},{default:r(()=>[s(D,{src:`${n.baseUrl}api/uploadAvatar/${c.user.avatar}`,crossorigin:e.credentials?"use-credentials":"anonymous"},null,8,["src","crossorigin"])]),_:1})]),_:1}),s(I,{style:{color:"white"}},{default:r(()=>[$("[ "+k(c.user.username)+" ]",1)]),_:1})]),_:1},8,["onClick"])),[[L]])]),_:1},8,["class"]),C(a("div",ne,[a("div",ie,[a("div",ce,[s(f,{color:"primary",icon:"account_circle",onClick:i.redirectToFriend},null,8,["onClick"]),s(f,{color:"primary",icon:"sports_esports",onClick:i.sendMatch},null,8,["onClick"]),o.private===!1?(h(),p(f,{key:0,color:"primary",icon:"question_answer",onClick:i.sendMessage},null,8,["onClick"])):(h(),p(f,{key:1,color:"warning",icon:"question_answer",onClick:i.receiveMessage},null,8,["onClick"])),s(f,{color:"negative",icon:"dangerous",onClick:i.deleteFriend},null,8,["onClick"])])]),s(G)],512),[[Q,n.showContent]])],64)}var he=F(ae,[["render",le]]);const de={components:{Friends:re,List:he,Notification:V},setup(){const e=l([]),t=l(""),c=l(!0);var o=l({});const n=l(null),i=E("bus"),_=async()=>{var d;try{const u=localStorage.getItem("jwtToken");if(u){const j=await fetch(`http://${window.location.hostname}:3000/api/update/searchUser`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`},credentials:"include",body:JSON.stringify({friend_search:t.value})});t.value="";const v=await j.json();v.success===!0?o.value=v.userFriend:(d=n.value)==null||d.showNotification(v.success+" : "+v.message)}}catch{console.error("Error crash with fetchData")}},m=async()=>{try{const d=localStorage.getItem("jwtToken");if(d){const j=await(await fetch(`http://${window.location.hostname}:3000/api/auth/profile/friendlist`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},credentials:"include"})).json();e.value=j}}catch{console.error("error with friendlist")}};return W(()=>{m(),i.on("freshFriend",()=>{m(),o.value={}})}),{text:t,dense:c,Search:o,userArray:e,checkForAdd:_,notificationRef:n,checkFriendList:m}}},ue=a("h5",{style:{"margin-bottom":"10px","text-align":"center"}},"Friends List",-1),pe=a("hr",{style:{border:"1px solid #ccc","margin-bottom":"1px"}},null,-1),fe=a("hr",{style:{border:"1px solid #ccc","margin-bottom":"1px"}},null,-1),me={key:0},ge=a("hr",{style:{border:"1px solid #ccc","margin-bottom":"1px"}},null,-1),_e=a("hr",{style:{border:"1px solid #ccc","margin-bottom":"1px"}},null,-1);function ye(e,t,c,o,n,i){const _=w("List"),m=w("Friends"),d=w("Notification");return h(),y(T,null,[a("div",null,[ue,pe,a("ul",null,[(h(!0),y(T,null,H(o.userArray,u=>(h(),p(_,{key:u.id,user:u},null,8,["user"]))),128))]),fe,s(K,{standout:"","bottom-slots":"",modelValue:o.text,"onUpdate:modelValue":t[1]||(t[1]=u=>o.text=u),label:"Search User",dense:o.dense,onKeyup:J(o.checkForAdd,["enter"])},{before:r(()=>[]),append:r(()=>[o.text!==""?(h(),p(A,{key:0,name:"close",onClick:t[0]||(t[0]=u=>o.text=""),class:"cursor-pointer"})):S("",!0),s(A,{name:"search",class:"cursor-pointer",onClick:o.checkForAdd},null,8,["onClick"])]),_:1},8,["modelValue","dense","onKeyup"])]),Object.keys(o.Search).length!==0?(h(),y("div",me,[a("div",null,[ge,a("ul",null,[(h(),p(m,{key:o.Search.id,search_data:o.Search},null,8,["search_data"]))]),_e])])):S("",!0),s(d,{ref:"notificationRef"},null,512)],64)}var we=F(de,[["render",ye]]);let g;const ve={components:{FriendsList:we},setup(){const e=l(!1);return{bus:E("bus"),rightDrawerOpen:e,toggleRightDrawer(){e.value=!e.value}}},data(){return{profileData:{},baseUrl:"http://"+window.location.hostname+":3000/",localIp:window.location.hostname}},methods:{async fetchProfileData(){try{const e=localStorage.getItem("jwtToken");if(e){const c=await(await fetch(`http://${this.localIp}:3000/api/auth/profile`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},credentials:"include"})).json();this.profileData=c}}catch{console.log("error")}},async WsConnect(){g=X(`http://${this.localIp}:3000/status`,{extraHeaders:{cookies:localStorage.getItem("jwtToken")}})},async sendOnLineMessage(){try{g.emit("onLine"),console.log("Message onLine envoy\xE9 avec succ\xE8s")}catch(e){console.error("Erreur lors de l'envoi du message onLine",e)}},async sendOffLineMessage(){try{g.emit("offLine"),console.log("Message OffLine envoy\xE9 avec succ\xE8s")}catch(e){console.error("Erreur lors de l'envoi du message OffLine:",e)}},async sendInGameMessage(){try{g.emit("inGame"),console.log("Message inGame envoy\xE9 avec succ\xE8s")}catch(e){console.error("Erreur lors de l'envoi du message inGame:",e)}},async sendInChatMessage(){try{g.emit("inChat"),console.log("Message inChat envoy\xE9 avec succ\xE8s")}catch(e){console.error("Erreur lors de l'envoi du message inChat:",e)}}},mounted(){this.fetchProfileData(),this.WsConnect(),this.sendOnLineMessage(),this.bus.on("refreshProfile",this.fetchProfileData),this.bus.on("inGameSet",this.sendInGameMessage),this.bus.on("inChatSet",this.sendInChatMessage),this.bus.on("inOnSet",this.sendOnLineMessage),this.bus.on("inOffSet",this.sendOffLineMessage),g.on("update",()=>{this.bus.emit("refreshFriend"),this.bus.emit("refreshList")})}},be=["src","crossorigin"],Ce={class:"absolute-bottom bg-transparent"},ke=["src","crossorigin"],Te={class:"text-weight-bold"};function Ie(e,t,c,o,n,i){const _=w("friends-list"),m=w("router-view");return h(),p(U,{view:"hHh lpR lFr"},{default:r(()=>[s(B,{reveal:"",elevated:"",class:"bg-primary text-white","height-hint":"98"},{default:r(()=>[s(M,null,{default:r(()=>[s(z,{class:"text-h6 text-center"},{default:r(()=>[s(b,{size:"75px"},{default:r(()=>[a("img",{src:`${n.baseUrl}api/uploadAvatar/logoLayout9.png`,crossorigin:e.credentials?"use-credentials":"anonymous"},null,8,be)]),_:1}),$(" T.R.I.S Pong ")]),_:1}),s(f,{dense:"",flat:"",round:"",icon:"menu",onClick:o.toggleRightDrawer},null,8,["onClick"])]),_:1}),s(q,{align:"center"},{default:r(()=>[s(x,{to:"/home",label:"Profile"}),s(x,{to:"/game",label:"Game"}),s(x,{to:"/chat",label:"Chat"})]),_:1})]),_:1}),s(Y,{modelValue:o.rightDrawerOpen,"onUpdate:modelValue":t[0]||(t[0]=d=>o.rightDrawerOpen=d),side:"right",overlay:"","show-if-above":"",bordered:""},{default:r(()=>[s(M,{style:{height:"130px"}},{default:r(()=>[s(D,{class:"absolute-top",src:"https://cdn.quasar.dev/img/material.png",style:{height:"150px"}},{default:r(()=>[a("div",Ce,[s(b,{size:"56px",class:"q-mb-sm"},{default:r(()=>[a("img",{src:`${n.baseUrl}api/uploadAvatar/${n.profileData.avatar}`,crossorigin:e.credentials?"use-credentials":"anonymous"},null,8,ke)]),_:1}),a("div",Te,k(n.profileData.pseudo),1),a("div",null,"@"+k(n.profileData.username),1)])]),_:1})]),_:1}),s(_)]),_:1},8,["modelValue"]),s(P,null,{default:r(()=>[s(m)]),_:1})]),_:1})}var De=F(ve,[["render",Ie]]);export{De as default};
