import{i as h,f as L,av as O,aw as W,ax as R,l as f,A as X,_ as B,o as b,$ as S,ay as H,az as D,aA as M,n as k,J as Q,aB as g,r as P,a as y,w as G,d as n,aC as q,a0 as T,e as U,a1 as j,aD as Y,aE as z,x as F}from"./index.dfe8dbd2.js";import{l as V}from"./index.9bf75406.js";import{u as J}from"./use-quasar.6bfedbf2.js";const K=[h("g",{transform:"translate(1 1)","stroke-width":"2",fill:"none","fill-rule":"evenodd"},[h("circle",{cx:"5",cy:"50",r:"5"},[h("animate",{attributeName:"cy",begin:"0s",dur:"2.2s",values:"50;5;50;50",calcMode:"linear",repeatCount:"indefinite"}),h("animate",{attributeName:"cx",begin:"0s",dur:"2.2s",values:"5;27;49;5",calcMode:"linear",repeatCount:"indefinite"})]),h("circle",{cx:"27",cy:"5",r:"5"},[h("animate",{attributeName:"cy",begin:"0s",dur:"2.2s",from:"5",to:"5",values:"5;50;50;5",calcMode:"linear",repeatCount:"indefinite"}),h("animate",{attributeName:"cx",begin:"0s",dur:"2.2s",from:"27",to:"27",values:"27;49;5;27",calcMode:"linear",repeatCount:"indefinite"})]),h("circle",{cx:"49",cy:"50",r:"5"},[h("animate",{attributeName:"cy",begin:"0s",dur:"2.2s",values:"50;50;5;50",calcMode:"linear",repeatCount:"indefinite"}),h("animate",{attributeName:"cx",from:"49",to:"49",begin:"0s",dur:"2.2s",values:"49;5;27;49",calcMode:"linear",repeatCount:"indefinite"})])])];var Z=L({name:"QSpinnerBall",props:O,setup(e){const{cSize:t,classes:l}=W(e);return()=>h("svg",{class:l.value,stroke:"currentColor",width:t.value,height:t.value,viewBox:"0 0 57 57",xmlns:"http://www.w3.org/2000/svg"},K)}});var u;const ee=R({props:{ctx:{type:Object,required:!0}},setup(e){const t={borderRadius:"20px",width:"100%",height:"100%"},l=f(null);return X(()=>e.ctx,(c,p)=>{console.log("REFRESH"),console.log("AFTER MOUNTED",u);const a=u.getContext("2d");if(console.log("Context",a),!a)return;console.log("CONTEXT");const d=localStorage.getItem("theme")||"#229964",m=localStorage.getItem("ball")||"white";a.clearRect(0,0,u.width,u.height),a.fillStyle=d,a.fillRect(0,0,u.width,u.height),a.setLineDash([5,5]);const i=u.width/2;a.beginPath(),a.moveTo(i,0),a.lineTo(i,u.height),a.strokeStyle="white",a.stroke(),a.setLineDash([]);const s=u.height/100,_=u.width/200,o=(c.paddle1+50)*s,w=(c.paddle2+50)*s,v=20*s,C=3*_,N=(c.ballX+100)*_,r=(c.ballY+50)*s,A=8;a.fillStyle="white",a.fillRect(0,o-v/2,C,v),a.fillStyle="white",a.fillRect(u.width-C,w-v/2,C,v),a.fillStyle=m,a.beginPath(),a.arc(N,r,A,0,Math.PI*2),a.fill()},{immediate:!1}),{canvasStyle:t,canvasRef:l}},mounted(){const e=this.$refs.canvas,t=e.getContext("2d"),l=localStorage.getItem("theme")||"#0273d4",c=localStorage.getItem("ball")||"white";if(!t)return;t.fillStyle=l,t.fillRect(0,0,e.width,e.height),t.setLineDash([5,5]);const p=e.width/2;t.beginPath(),t.moveTo(p,0),t.lineTo(p,e.height),t.strokeStyle="white",t.stroke(),t.setLineDash([]);const a=e.height/100,d=e.width/200,m=(this.ctx.paddle1+50)*a,i=(this.ctx.paddle2+50)*a,s=20*a,_=3*d,o=(this.ctx.ballX+100)*d,w=(this.ctx.ballY+50)*a,v=8;t.fillStyle="white",t.fillRect(0,m-s/2,_,s),t.fillStyle="white",t.fillRect(e.width-_,i-s/2,_,s),t.fillStyle=c,t.beginPath(),t.arc(o,w,v,0,Math.PI*2),t.fill(),u=e,console.log("BEFORE MOUNTED",u)}});function te(e,t,l,c,p,a){return b(),S("canvas",{id:"myCanvas",ref:"canvas",width:"700",height:"400",style:H(e.canvasStyle),class:"gameCanvas"},null,4)}var ae=B(ee,[["render",te],["__scopeId","data-v-77b00222"]]);function oe(){const e=localStorage.getItem("jwtToken");return V(`http://${window.location.hostname}:3000`,{extraHeaders:{cookies:e}})}const se=R({components:{CanvasGame:ae},setup(){const e=f({}),t=J(),l=D();l.query;let c=l.query.frind_id,p=l.query.owner,a=l.query.accept;f("default"),f("default");const d=f(),m=f(),i=f(!1),s=f(!1),_=f(!1);M();var{gameSocket:o,connectSockets:w,disconnectSockets:v}=M();const C=()=>{console.log("GAME LAUNCH"),i.value=!0};k(()=>{w()}),Q(()=>{v()}),k(()=>{g(o,"connect",()=>{}),g(o,"disconnect",()=>{})}),k(()=>{o.value=oe(),w()}),Q(()=>{v()}),k(()=>{!o.value||o.value.connected||(localStorage.removeItem("theme"),localStorage.removeItem("ball"),c&&(t.dialog({title:"Theme Selector",message:"Choose your Theme:",options:{type:"radio",model:"opt1",items:[{label:"Green & White",value:"opt1",color:"secondary"},{label:"Blue & White",value:"opt2"},{label:"Yellow & Black",value:"opt3"}]},persistent:!0}).onOk(r=>{r==="opt2"?(localStorage.setItem("theme","#333399"),localStorage.setItem("ball","white")):r==="opt3"&&(localStorage.setItem("theme","#dada3d"),localStorage.setItem("ball","black"))}),o.value.emit("privateQueue",{owner:p==="yes",second:c,accept:a==="yes"}),N()))});const N=()=>{c=null,p=null,a=null};return k(()=>{!o.value||o.value.connected||(g(o,"connect",()=>{}),g(o,"disconnect",()=>{}),g(o,"joinQueueSuccess",()=>{t.dialog({title:"Theme Selector",message:"Choose your Theme:",options:{type:"radio",model:"opt1",items:[{label:"Green & White",value:"opt1",color:"secondary"},{label:"Blue & White",value:"opt2"},{label:"Yellow & Black",value:"opt3"}]},persistent:!0}).onOk(r=>{r==="opt2"?(localStorage.setItem("theme","#333399"),localStorage.setItem("ball","white")):r==="opt3"&&(localStorage.setItem("theme","#dada3d"),localStorage.setItem("ball","black")),e.value.inQueue=!0,s.value=!0})}),g(o,"joinPrivateQueueSuccess",()=>{e.value.inQueue=!0,s.value=!0}),g(o,"leaveQueueSuccess",()=>{e.value.inQueue=!1,s.value=!1}),g(o,"gameStart",r=>{e.value={inQueue:!1,gameState:r},i.value=!0}),g(o,"gameUpdate",r=>{e.value.gameState=r}),g(o,"gameEnd",()=>{_.value=!0,e.value={inQueue:!1,gameState:null},i.value=!1,s.value=!1,d.value=void 0,m.value=void 0}),o.value.connect())}),k(()=>{const r=E=>{var I,$;E.key==="ArrowUp"&&((I=o.value)==null||I.emit("startUp")),E.key==="ArrowDown"&&(($=o.value)==null||$.emit("startDown"))},A=E=>{var I,$;E.key==="ArrowUp"&&((I=o.value)==null||I.emit("stopUp")),E.key==="ArrowDown"&&(($=o.value)==null||$.emit("stopDown"))};document.addEventListener("keydown",r),document.addEventListener("keyup",A),Q(()=>{o.value&&(o.value.disconnect(),o.value=null),document.removeEventListener("keydown",r),document.removeEventListener("keyup",A)})}),{gameSocket:o,gameContext:e,players1:d,players2:m,connectSockets:w,disconnectSockets:v,gameStarted:i,queueStarted:s,startingGame:C,location,gameisEnd:_}}}),x=e=>(Y("data-v-6754dd7f"),e=e(),z(),e),ne={key:0,class:"q-pa-md game-container button-container"},le={class:"flex flex-col items-center justify-center"},ce=x(()=>n("div",{class:"Title-game mb-10"},"Welcome to T.R.I.S Game",-1)),ie=x(()=>n("span",{class:"actual-text"},"\xA0PONG\xA0",-1)),re=[ie],ue={key:1,class:"q-pa-md game-container button-container"},de={class:"flex flex-col items-center justify-center"},me=x(()=>n("div",{class:"Title-game mb-10"},"Awaiting a challenger...",-1)),he=x(()=>n("span",{class:"actual-text"},"\xA0LEAVE\xA0",-1)),pe=[he],ve={key:2,class:"q-pa-md game-container button-container"},ge=x(()=>n("div",{class:"flex flex-col items-center justify-center"},[n("div",{class:"result-message"},[n("h1",null,"END GAME!"),n("h2",null,"Check History on Profile")])],-1)),fe={class:"players-name"},_e={class:""},ye=x(()=>n("br",null,null,-1)),be={class:"custom-button"},Se=x(()=>n("span",{class:"actual-text"},"\xA0GIVE UP\xA0",-1)),we=[Se];function ke(e,t,l,c,p,a){var m,i;const d=P("CanvasGame");return e.gameStarted===!1&&e.queueStarted===!1&&e.gameisEnd===!1?(b(),S("div",ne,[y(q,{class:"Game custom-background",flat:"",bordered:""},{default:G(()=>[n("div",le,[ce,n("button",{class:"custom-button","data-text":"Awesome",onClick:t[0]||(t[0]=()=>{var s;(s=e.gameSocket)==null||s.emit("joinQueue")})},re)])]),_:1})])):e.gameStarted===!1&&e.queueStarted===!0&&e.gameisEnd===!1?(b(),S("div",ue,[y(q,{class:"Game custom-background",flat:"",bordered:""},{default:G(()=>[n("div",de,[me,y(Z,{color:"black",size:"5.5em"}),n("button",{class:"custom-button","data-text":"Awesome",onClick:t[1]||(t[1]=()=>{var s;(s=e.gameSocket)==null||s.emit("leaveQueue")})},pe)])]),_:1})])):e.gameisEnd===!0?(b(),S("div",ve,[y(q,{class:"Game custom-background",flat:"",bordered:""},{default:G(()=>[ge]),_:1})])):(b(),S(j,{key:3},[n("div",fe,[n("div",_e,T((m=e.players1)==null?void 0:m.name)+" VS "+T((i=e.players2)==null?void 0:i.name),1),ye,U(" "+T(e.gameContext.gameState.score1)+" - "+T(e.gameContext.gameState.score2),1)]),y(d,{ctx:e.gameContext.gameState},null,8,["ctx"]),n("div",be,[n("button",{class:"custom-button",onClick:t[2]||(t[2]=()=>{var s;return(s=e.gameSocket)==null?void 0:s.emit("abondonGame")})},we)])],64))}var xe=B(se,[["render",ke],["__scopeId","data-v-6754dd7f"]]);const Ce={components:{PongGame:xe},setup(){const e=D(),t=e.query,l=f(!1);return k(()=>{console.log("query after = ",t),t&&(l.value=!0)}),{route:e,queryParams:t,game:l}},data(){return{message:"Ping!",bus:F("bus"),baseUrl:"http://"+window.location.hostname+":3000/",localIp:window.location.hostname}},methods:{async checkToken(){const e=localStorage.getItem("jwtToken");if(e)try{(await(await fetch(`http://${this.localIp}:3000/api/auth/checkJWT`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},credentials:"include"})).json()).success?console.log("user validate!"):(console.log("Unvalidate user!"),this.$router.push("/"))}catch{console.log("Error with validating JWT!"),this.$router.push("/")}else console.log("User not connected!"),this.$router.push("/")}},mounted(){this.checkToken(),this.bus.emit("inGameSet")}},Ee={class:"page-container"},Ie={class:"flex-container"},$e={key:0,class:"button-container"},Te={key:1};function Ge(e,t,l,c,p,a){const d=P("Button"),m=P("PongGame"),i=P("SocketProvider");return b(),S(j,null,[n("div",Ee,[n("h2",null,T(p.message),1)]),n("div",Ie,[c.game!==!0?(b(),S("div",$e,[y(d,{onClick:t[0]||(t[0]=s=>c.game=!0),class:"custom-button"},{default:G(()=>[U("Quick match")]),_:1})])):(b(),S("div",Te,[y(i,null,{default:G(()=>[y(m)]),_:1})]))])],64)}var Qe=B(Ce,[["render",Ge]]);export{Qe as default};
